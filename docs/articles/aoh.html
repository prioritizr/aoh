<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>aoh: Create Area of Habitat Data • aoh</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="aoh: Create Area of Habitat Data">
<meta property="og:description" content="aoh">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">aoh</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.99999</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/aoh.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/prioritizr/aoh/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>aoh: Create Area of Habitat Data</h1>
            
            <h4 data-toc-skip class="date">2022-05-07</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/prioritizr/aoh/blob/HEAD/vignettes/aoh.Rmd" class="external-link"><code>vignettes/aoh.Rmd</code></a></small>
      <div class="hidden name"><code>aoh.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Area of Habitat (AOH) maps aim to delineate the spatial distribution of suitable habitat for a species <span class="citation">(Brooks <em>et al.</em> 2019)</span>. They are used to assess performance of protected area systems, measure impacts of threats to biodiversity, and identify priorities for conservation actions <span class="citation">(Tracewski <em>et al.</em> 2016; Rondinini <em>et al.</em> 2005; Durán <em>et al.</em> 2020)</span>. These maps are generally produced by obtaining geographic range data for a species, and then removing areas that do not contain suitable habitat or occur outside the known elevational limits for the species <span class="citation">(Brooks <em>et al.</em> 2019)</span>. To help make these maps accessible, the <em>aoh R</em> package provides routines for automatically creating Area of Habitat data based on the <a href="https://www.iucnredlist.org/" class="external-link">International Union for Conservation of Nature (IUCN) Red List of Threatened Species</a>. After manually downloading species range data from the <a href="https://www.iucnredlist.org/resources/spatial-data-download" class="external-link">IUCN Red List</a>, users can import them (using <code><a href="../reference/read_spp_range_data.html">read_spp_range_data()</a></code>), prepare them and collate additional information for subsequent processing (using <code><a href="../reference/create_spp_info_data.html">create_spp_info_data()</a></code>), and then create Area of Habitat data (using <code><a href="../reference/create_spp_aoh_data.html">create_spp_aoh_data()</a></code>). Global elevation and habitat classification data are automatically downloaded <span class="citation">(Robinson <em>et al.</em> 2014; Jung <em>et al.</em> 2020; Lumbierres <em>et al.</em> 2021)</span>, and data on species’ habitat preferences and elevational limits are obtained automatically using the <a href="https://apiv3.iucnredlist.org/" class="external-link">IUCN Red List API</a>. Since accessing the IUCN Red List requires a token, users may need to <a href="https://apiv3.iucnredlist.org/api/v3/token" class="external-link">obtain a token</a> and update their <em>R</em> configuration to recognize the token (see below for details).</p>
</div>
<div class="section level2">
<h2 id="tutorial">Tutorial<a class="anchor" aria-label="anchor" href="#tutorial"></a>
</h2>
<p>Here we provide a tutorial for using the <em>aoh R</em> package. In this tutorial, we will generate Area of Habitat data for the following Iberian species: Pyrenean brook salamander (<em>Calotriton asper</em>), Iberian frog (<em>Rana iberica</em>), western spadefoot toad (<em>Pelobates cultripes</em>), and golden striped salamnader (<em>Chioglossa lusitanica</em>). To start off, we will load the package. We will also load the <a href="https://CRAN.R-project.org/package=rappdirs" class="external-link"><em>rappdirs</em></a> <em>R</em> package to cache data, and the <a href="https://CRAN.R-project.org/package=terra" class="external-link"><em>terra</em></a> and <a href="https://CRAN.R-project.org/package=ggplot2" class="external-link"><em>ggplot2</em></a> <em>R</em> packages to visualize results.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load packages</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://prioritizr.github.io/aoh/" class="external-link">aoh</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/terra/" class="external-link">terra</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rappdirs.r-lib.org" class="external-link">rappdirs</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></code></pre></div>
<p>Now we will import range data for the species. Although users would typically obtain range data from the <a href="https://www.iucnredlist.org/" class="external-link">International Union for Conservation of Nature (IUCN) Red List of Threatened Species</a>, here we will use built-in species range data that distributed with the package for convenience. <strong>Please note that these data were not obtained from the IUCN Red List, and were manually generated using occurrence records from the <a href="https://www.gbif.org/" class="external-link">Global Biodiversity Information Facility</a>.</strong></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># find file path for data</span>
<span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"EXAMPLE_SPECIES.zip"</span>, package <span class="op">=</span> <span class="st">"aoh"</span><span class="op">)</span>

<span class="co"># import data</span>
<span class="va">spp_range_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_spp_range_data.html">read_spp_range_data</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span>

<span class="co"># preview data</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">spp_range_data</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Simple feature collection with 4 features and 26 fields</span>
<span class="co">## Geometry type: POLYGON</span>
<span class="co">## Dimension:     XY</span>
<span class="co">## Bounding box:  xmin: -9.479736 ymin: 36.59422 xmax: 3.302702 ymax: 43.76455</span>
<span class="co">## Geodetic CRS:  WGS 84</span>
<span class="co">## <span style="color: #949494;"># A tibble: 4 × 27</span></span>
<span class="co">##   id_no binomial           presence origin seasonal compiler yrcompiled citation</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span>
<span class="co">## <span style="color: #BCBCBC;">1</span>   979 Alytes dickhilleni        1      1        1 Derived…         <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>      </span>
<span class="co">## <span style="color: #BCBCBC;">2</span> <span style="text-decoration: underline;">59</span>448 Calotriton asper          1      1        1 Derived…         <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>      </span>
<span class="co">## <span style="color: #BCBCBC;">3</span>  <span style="text-decoration: underline;">4</span>657 Chioglossa lusita…        1      1        1 Derived…         <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>      </span>
<span class="co">## <span style="color: #BCBCBC;">4</span> <span style="text-decoration: underline;">58</span>622 Rana iberica              1      1        1 Derived…         <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>      </span>
<span class="co">## <span style="color: #949494;"># … with 19 more variables: subspecies &lt;chr&gt;, subpop &lt;chr&gt;, source &lt;chr&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   island &lt;chr&gt;, tax_comm &lt;chr&gt;, dist_comm &lt;chr&gt;, generalisd &lt;int&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   legend &lt;chr&gt;, kingdom &lt;chr&gt;, phylum &lt;chr&gt;, class &lt;chr&gt;, order_ &lt;chr&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   family &lt;chr&gt;, genus &lt;chr&gt;, category &lt;chr&gt;, marine &lt;chr&gt;, terrestial &lt;chr&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   freshwater &lt;chr&gt;, geometry &lt;POLYGON [°]&gt;</span></span></code></pre>
<p>Next, we will prepare all the range data for generating Area of Habitat data. This procedure – in addition to repairing any geometry issues in the spatial data – will obtain information on the species’ habitat preferences and elevational limits (via the IUCN Red List of Threatened Species). We also specify a folder to cache the downloaded data so that we won’t need to re-download it again during subsequent runs.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify cache directory</span>
<span class="va">cache_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rappdirs.r-lib.org/reference/user_data_dir.html" class="external-link">user_data_dir</a></span><span class="op">(</span><span class="st">"aoh"</span><span class="op">)</span>

<span class="co"># create cache_dir if needed</span>
<span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">cache_dir</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">cache_dir</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># prepare information</span>
<span class="va">spp_info_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_spp_info_data.html">create_spp_info_data</a></span><span class="op">(</span><span class="va">spp_range_data</span>, cache_dir <span class="op">=</span> <span class="va">cache_dir</span><span class="op">)</span></code></pre></div>
<p>We can now generate Area of Habitat data for the species. By default, these data will be generated using elevation data derived from <a href="https://doi.org/10.1038/sdata.2018.40" class="external-link">Amatulli <em>et al.</em> 2018</a> and habitat data derived from <a href="https://doi.org/10.1111/cobi.13851" class="external-link">Lumbierres <em>et al.</em> 2021</a>. Similar to before, we also specify a folder to cache the downloaded datasets so that we won’t need to re-downloaded again during subsequent runs.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify cache directory</span>
<span class="va">cache_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rappdirs.r-lib.org/reference/user_data_dir.html" class="external-link">user_data_dir</a></span><span class="op">(</span><span class="st">"aoh"</span><span class="op">)</span>

<span class="co"># specify folder to save Area of Habitat data</span>
<span class="co">## although we use a temporary directory here to avoid polluting your</span>
<span class="co">## with examples files, you would normally specify the folder</span>
<span class="co">## on your computer where you want to save data</span>
<span class="va">output_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># generate Area of Habitat data</span>
<span class="co">## note that this function might take a complete because it will need to</span>
<span class="co">## download the global habitat and elevation data that first time you run it.</span>
<span class="va">spp_aoh_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_spp_aoh_data.html">create_spp_aoh_data</a></span><span class="op">(</span>
  <span class="va">spp_info_data</span>, output_dir <span class="op">=</span> <span class="va">output_dir</span>, cache_dir <span class="op">=</span> <span class="va">cache_dir</span>
<span class="op">)</span>

<span class="co"># preview results</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">spp_aoh_data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id_no"</span>, <span class="st">"seasonal"</span>, <span class="st">"path"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p>While running the code, we see that it displayed a message telling us that certain habitat classes were not available (i.e., <code>"7.1"</code>, <code>"7.2"</code>). <strong>This is fine. It is not an error.</strong> The reason we see this message is because although the global habitat dataset contains the majority of <a href="https://www.iucnredlist.org/resources/habitat-classification-scheme" class="external-link">IUCN habitat classes</a> for terrestrial environments, it does not contain every single IUCN habitat class <span class="citation">(see Lumbierres <em>et al.</em> 2021 for details)</span>. Upon checking the <a href="https://www.iucnredlist.org/resources/habitat-classification-scheme" class="external-link">IUCN habitat classes</a>, we can see that these classes correspond to artificial aquatic areas and also caves and other subterranean environments. Although failing to account for such habitats could potentially be an issue, here we will assume that accounting for the species’ non-subterranean habitats is sufficient to describe their spatial distribution <span class="citation">(Ficetola <em>et al.</em> 2014)</span>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># preview results</span>
<span class="co">## resulting dataset is a simple features (sf) object containing</span>
<span class="co">## spatial geometries for cleaned versions of the range data</span>
<span class="co">## (in the geometry column) and the following additional columns:</span>
<span class="co">##</span>
<span class="co">## - id_no            : IUCN Red List taxon identifier</span>
<span class="co">## - seasonal         : integer identifier for seasonal distributions</span>
<span class="co">## - category         : character IUCN Red List threat category</span>
<span class="co">## - full_habitat_code: All IUCN Red List codes for suitable habitat classes</span>
<span class="co">##                      (multiple codes are delimited using "|" symbols)</span>
<span class="co">## - habitat_code     : IUCN Red List codes for suitable habitat classes</span>
<span class="co">##                      used to create AOH maps</span>
<span class="co">## - elevation_lower  : lower limit for the species on IUCN Red List</span>
<span class="co">## - elevation_upper  : upper limit for the species on IUCN Red List</span>
<span class="co">## - xmin             : minimum x-coordinate for Area of Habitat data</span>
<span class="co">## - xmax             : maximum x-coordinate for Area of Habitat data</span>
<span class="co">## - ymin             : minimum y-coordinate for Area of Habitat data</span>
<span class="co">## - ymax             : maximum y-coordinate for Area of Habitat data</span>
<span class="co">## - path             : file path for Area of Habitat data (GeoTIFF format)</span>
<span class="co">##</span>
<span class="co">## since data obtained from the IUCN Red List cannot be redistributed,</span>
<span class="co">## we will not show all the columns in this object</span>
<span class="co">##</span>
<span class="co">## N.B. you can view all columns on your computer with: print(spp_aoh_data)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">spp_aoh_data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id_no"</span>, <span class="st">"seasonal"</span>, <span class="st">"path"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Simple feature collection with 4 features and 3 fields</span>
<span class="co">## Geometry type: POLYGON</span>
<span class="co">## Dimension:     XY</span>
<span class="co">## Bounding box:  xmin: -914690 ymin: 4364364 xmax: 318662 ymax: 5066731</span>
<span class="co">## Projected CRS: World_Behrmann</span>
<span class="co">## <span style="color: #949494;"># A tibble: 4 × 4</span></span>
<span class="co">##   id_no seasonal path                                                   geometry</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                             <span style="color: #949494; font-style: italic;">&lt;POLYGON [m]&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span>   979        1 /tmp/RtmpMEO3Rn/979_1.tif   ((-105492 4465129, -106457 4464790…</span>
<span class="co">## <span style="color: #BCBCBC;">2</span> <span style="text-decoration: underline;">59</span>448        1 /tmp/RtmpMEO3Rn/59448_1.tif ((-238707 5029084, -237742 5028026…</span>
<span class="co">## <span style="color: #BCBCBC;">3</span>  <span style="text-decoration: underline;">4</span>657        1 /tmp/RtmpMEO3Rn/4657_1.tif  ((-859178 4559308, -859307 4559308…</span>
<span class="co">## <span style="color: #BCBCBC;">4</span> <span style="text-decoration: underline;">58</span>622        1 /tmp/RtmpMEO3Rn/58622_1.tif ((-849787 4614155, -848114 4615218…</span></code></pre>
<p>After generating the Area of Habitat data, we can import them.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># import the Area of Habitat data</span>
<span class="co">## since the data for each species have a different spatial extent</span>
<span class="co">## (to reduce file sizes), we will import each dataset separately in a list</span>
<span class="va">spp_aoh_rasters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">spp_aoh_data</span><span class="op">$</span><span class="va">path</span>, <span class="va">rast</span><span class="op">)</span>

<span class="co"># preview raster data</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">spp_aoh_rasters</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [[1]]</span>
<span class="co">## class       : SpatRaster </span>
<span class="co">## dimensions  : 2594, 3701, 1  (nrow, ncol, nlyr)</span>
<span class="co">## resolution  : 100, 100  (x, y)</span>
<span class="co">## extent      : -467931, -97831, 4364277, 4623677  (xmin, xmax, ymin, ymax)</span>
<span class="co">## coord. ref. : World_Behrmann </span>
<span class="co">## source      : 979_1.tif </span>
<span class="co">## name        : lyr1 </span>
<span class="co">## min value   :    0 </span>
<span class="co">## max value   :    1 </span>
<span class="co">## </span>
<span class="co">## [[2]]</span>
<span class="co">## class       : SpatRaster </span>
<span class="co">## dimensions  : 2265, 5669, 1  (nrow, ncol, nlyr)</span>
<span class="co">## resolution  : 100, 100  (x, y)</span>
<span class="co">## extent      : -248231, 318669, 4838377, 5064877  (xmin, xmax, ymin, ymax)</span>
<span class="co">## coord. ref. : World_Behrmann </span>
<span class="co">## source      : 59448_1.tif </span>
<span class="co">## name        : lyr1 </span>
<span class="co">## min value   :    0 </span>
<span class="co">## max value   :    1 </span>
<span class="co">## </span>
<span class="co">## [[3]]</span>
<span class="co">## class       : SpatRaster </span>
<span class="co">## dimensions  : 5149, 5360, 1  (nrow, ncol, nlyr)</span>
<span class="co">## resolution  : 100, 100  (x, y)</span>
<span class="co">## extent      : -914731, -378731, 4551877, 5066777  (xmin, xmax, ymin, ymax)</span>
<span class="co">## coord. ref. : World_Behrmann </span>
<span class="co">## source      : 4657_1.tif </span>
<span class="co">## name        : lyr1 </span>
<span class="co">## min value   :    0 </span>
<span class="co">## max value   :    1 </span>
<span class="co">## </span>
<span class="co">## [[4]]</span>
<span class="co">## class       : SpatRaster </span>
<span class="co">## dimensions  : 4978, 7512, 1  (nrow, ncol, nlyr)</span>
<span class="co">## resolution  : 100, 100  (x, y)</span>
<span class="co">## extent      : -904331, -153131, 4568977, 5066777  (xmin, xmax, ymin, ymax)</span>
<span class="co">## coord. ref. : World_Behrmann </span>
<span class="co">## source      : 58622_1.tif </span>
<span class="co">## name        : lyr1 </span>
<span class="co">## min value   :    0 </span>
<span class="co">## max value   :    1</span></code></pre>
<p>We can see that the Area of Habitat data for each species are stored in separate spatial (raster) datasets with different extents. Although this is useful because it drastically reduces the total size of the data for each species, it can make it difficult to work with data for multiple species. To address this, we can use the <code><a href="../reference/terra_combine.html">terra_combine()</a></code> function to automatically align and combine the spatial data for all species’ distributions into a single spatial dataset.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># combine raster data</span>
<span class="va">spp_aoh_rasters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/terra_combine.html">terra_combine</a></span><span class="op">(</span><span class="va">spp_aoh_rasters</span><span class="op">)</span>

<span class="co"># assign identifiers to layer names</span>
<span class="fu"><a href="https://rdrr.io/pkg/terra/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">spp_aoh_rasters</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span>
  <span class="st">"AOH_"</span>, <span class="va">spp_aoh_data</span><span class="op">$</span><span class="va">id_no</span>, <span class="st">"_"</span>, <span class="va">spp_aoh_data</span><span class="op">$</span><span class="va">seasonal</span>
<span class="op">)</span>

<span class="co"># preview raster data</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">spp_aoh_rasters</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## class       : SpatRaster </span>
<span class="co">## dimensions  : 7025, 12334, 4  (nrow, ncol, nlyr)</span>
<span class="co">## resolution  : 100, 100  (x, y)</span>
<span class="co">## extent      : -914731, 318669, 4364277, 5066777  (xmin, xmax, ymin, ymax)</span>
<span class="co">## coord. ref. : World_Behrmann </span>
<span class="co">## sources     : memory  </span>
<span class="co">##               memory  </span>
<span class="co">##               memory  </span>
<span class="co">##               ... and 1 more source(s)</span>
<span class="co">## names       : AOH_979_1, AOH_59448_1, AOH_4657_1, AOH_58622_1 </span>
<span class="co">## min values  :         0,           0,          0,           0 </span>
<span class="co">## max values  :         1,           1,          1,           1</span></code></pre>
<p>Finally, let’s create some maps to compare the range data with the Area of habitat data. Although we could create these maps manually (e.g., using the <a href="https://CRAN.R-project.org/package=ggplot2" class="external-link"><em>ggplot2</em></a> <em>R</em> package), we will use a plotting function distributed with the <em>aoh R</em> package for convenience.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create maps</span>
<span class="va">map</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../reference/plot_spp_aoh_data.html">plot_spp_aoh_data</a></span><span class="op">(</span><span class="va">spp_aoh_data</span>, zoom <span class="op">=</span> <span class="fl">6</span>, maptype <span class="op">=</span> <span class="st">"toner-background"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"range"</span> <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_size_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"range"</span> <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>
    axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
    axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,
    strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>,
    strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"black"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>
  <span class="op">)</span>

<span class="co"># display maps</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">map</span><span class="op">)</span></code></pre></div>
<p><img src="aoh_files/figure-html/unnamed-chunk-10-1.png" width="90%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="frequently-asked-questions">Frequently asked questions<a class="anchor" aria-label="anchor" href="#frequently-asked-questions"></a>
</h2>
<p>Here we provide answers to some of the frequently asked questions encountered when using the package.</p>
<ul>
<li>
<p><strong>I see the following error message <code>Error: need an API key for Red List data</code>, how do I resolve this?</strong></p>
<p>This error message indicates that you need to obtain a token to access the <a href="https://apiv3.iucnredlist.org/" class="external-link">IUCN Red List API</a>, or that you need to complete the setup process so that R can use the token. For further details on resolving this issue, please see below for details on obtaining access to the IUCN Red List API. If you have previously completed the set up procedures and still receive this error message, please try completing them again.</p>
</li>
<li>
<p><strong>How do I obtain access to the IUCN Red List API?</strong></p>
<p>You will need to obtain a token to access the <a href="https://apiv3.iucnredlist.org/" class="external-link">IUCN Red List API</a> (if you do not have one already). To achieve this, please visit the IUCN website and fill out the form to apply for a token (see <a href="https://apiv3.iucnredlist.org/api/v3/token" class="external-link uri">https://apiv3.iucnredlist.org/api/v3/token</a>). You should then receive a token shortly after completing the form (but not immediately). After receiving a token, you will need to complete some additional steps so that R can use this token to access the IUCN Red List API.</p>
<p>Please open the <code>.Renviron</code> file on your computer (e.g., using <code><a href="https://usethis.r-lib.org/reference/edit.html" class="external-link">usethis::edit_r_environ()</a></code>). Next, please add the following text to the file (replacing the string with the token) and save the file:</p>
<pre><code><span class="va">IUCN_REDLIST_KEY</span><span class="op">=</span><span class="st">"your_actual_token_not_this_string"</span></code></pre>
<p>Please restart your R session. You should now be able to access the IUCN Red List API. To verify this, please try running the following <em>R</em> code and – assuming everything works correctly – you should see the current version of the IUCN Red List:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># verify access to IUCN Red List API</span>
<span class="fu">rredlist</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rredlist/reference/rl_version.html" class="external-link">rl_version</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>If these instructions did not work, please consult the documentation for the <a href="https://CRAN.R-project.org/package=rredlist" class="external-link"><em>rredlist</em></a> <em>R</em> package for further details.</p>
</li>
<li>
<p><strong>Where can I find species range data for generating Area of Habitat data?</strong></p>
<p>Species range data can be obtained from the <a href="https://www.iucnredlist.org/" class="external-link">IUCN Red List</a> (see <a href="https://www.iucnredlist.org/resources/spatial-data-download" class="external-link">Spatial Data Download resources</a>). They can also be obtained from other data sources (see the question below for details).</p>
</li>
<li>
<p><strong>I keep seeing this message <code>Error in x$.self$finalize() : attempt to apply non-function</code>, what does it mean?</strong></p>
<p>This message is commonly encountered when using the <em>terra</em> package with large datasets. Although there is currently no known solution to prevent this message from appearing, the message can be safely ignored (<a href="https://github.com/rspatial/terra/issues/30" class="external-link">see here for details</a>). This is because the message does not stop R from completing spatial data processing – meaning that R will continue processing data even when this message is displayed – and the underlying cause of the message is not thought to result in incorrect calculations.</p>
</li>
<li>
<p><strong>Can I produce Area of Habitat data for species globally?</strong></p>
<p>Yes, the package can generate Area of Habitat data for species globally. To accomplish this, you will need a system with at least 16 Gb RAM and 65 Gb disk space. Additionally, the processing will likely take multiple days to complete. This is because it can take several days to obtain data from the IUCN Red List API, and it can also take several days to complete the subsequent spatial data processing. An example script for processing global data is available on the online code repository (<a href="https://github.com/prioritizr/aoh/tree/master/inst/examples" class="external-link">see here</a>). Additionally, to improve performance when processing data for birds globally, it is recommended to split the full dataset into multiple chunks (e.g., six chunks) and process each of these separately.</p>
</li>
<li>
<p><strong>How can I speed up the processing for Area of Habitat data?</strong></p>
<p>The <code><a href="../reference/create_spp_aoh_data.html">create_spp_aoh_data()</a></code> function can use different software engines for data processing (specified via the <code>engine</code> parameter). Although each engine produces the same results, some engines are more computationally efficient than others. The default <code>"terra"</code> engine uses the <em>terra</em> package for processing. Although this engine is easy to install and fast for small datasets, it does not scale well for larger datasets. It is generally recommended to use the <code>"gdal"</code> engine in all cases where possible. Although the <code>"gdal"</code> engine requires installation of additional software (see the package README for instructions), it is much faster than the other engines. Additionally, the <code>"grass"</code> engine is also available. This engine can be faster than the <code>"terra"</code> engine when processing many species across large spatial extents. However, benchmarks indicate that it is slower than the <code>"gdal"</code> engine.</p>
</li>
<li>
<p><strong>Can I use species range data from other data sources (instead of the IUCN Red List)?</strong></p>
<p>Yes, you can use species range data from a variety of sources. For example, species range data could be obtained from governmental (e.g., data for federally listed species in Canada are available through the <a href="https://open.canada.ca/en/open-data" class="external-link">Government of Canada data portal</a>) and non-governmental organizations (e.g., <a href="https://biendata.org/" class="external-link">Botanical Information and Ecology Network</a> and <a href="https://mol.org/" class="external-link">Map of Life</a>). These data can also be produced using observation records <span class="citation">(e.g., following Palacio <em>et al.</em> 2021)</span> from data repositories (e.g., <a href="https://www.gbif.org/" class="external-link">Global Biodiversity Information Facility</a> and <a href="https://www.ala.org.au/" class="external-link">Atlas of Living Australia</a>). After obtaining species range data, they will need to be formatted so that they follow the data format conventions used by the IUCN Red List. This means that the species range data must contain the following columns: <code>id_no</code>, <code>presence</code>, <code>origin</code>, <code>seasonal</code>, <code>terrestrial</code> (or <code>terrestial</code>), <code>freshwater</code>, and <code>marine</code>. For further details on what values these columns should contain, please see the <strong>Species range data format</strong> section in the documentation for <code><a href="../reference/create_spp_info_data.html">create_spp_info_data()</a></code> and the <a href="https://www.iucnredlist.org/resources/mappingstandards" class="external-link">IUCN Red List documentation</a>. Additionally, note that if you wish to use the IUCN Red List for specifying habitat preference data, please ensure that the <code>id_no</code> specified for each species follows the taxon identifiers used by the IUCN Red List. For example, the tutorial used manually generated species range data for the Pyrenean brook salamander (<em>Calotriton asper</em>). To ensure that correct habitat preference data were obtained for this species from the the IUCN Red List, the <code>id_no</code> value specified for this species was specified as <code>59448</code>.</p>
</li>
<li>
<p><strong>Can I use habitat classification data from other data sources?</strong></p>
<p>Yes, you can use habitat classification data from a variety of sources. For example, the habitat classification data could be derived from <a href="https://land.copernicus.eu/pan-european/corine-land-cover" class="external-link">Copernicus Corine Land Cover</a>, <a href="https://lpdaac.usgs.gov/products/mcd12q1v006/" class="external-link">MODIS Land Cover data (MCD12Q1)</a>). To use such data, you will also need to develop a crosswalk table to specify which land cover (or habitat) classes correspond to which habitat classes as defined by the <a href="https://www.iucnredlist.org/resources/habitat-classification-scheme" class="external-link">IUCN Red List Habitat Classification Scheme</a> <span class="citation">(e.g., see Tracewski <em>et al.</em> 2016; Lumbierres <em>et al.</em> 2021)</span>. After preparing the habitat classification data and the crosswalk table, they can be used to create Area of Habitat data (via <code><a href="../reference/create_spp_aoh_data.html">create_spp_aoh_data()</a></code>).</p>
</li>
<li>
<p><strong>Can I use elevational limit data from other sources?</strong></p>
<p>Yes, you can use elevational limit data from other sources. For example, you could obtain such data from the BirdLife Data Zone (e.g., see the <em>Occasional altitudinal limits</em> for the <a href="http://datazone.birdlife.org/species/factsheet/eurasian-buzzard-buteo-buteo/details" class="external-link">Eurasian buzzard <em>Buteo Buteo</em></a>). To use such data, you will need to manually create a table containing the species’ summary information. This table will need to contain information on the species’ elevational limits, as well as their habitat preferences and threat status (see <code><a href="../reference/get_spp_summary_data.html">get_spp_summary_data()</a></code> for the correct format). After preparing these data, they can be used to collate the information needed for processing Area of Habitat data (via <code><a href="../reference/create_spp_info_data.html">create_spp_info_data()</a></code>) and, in turn, create Area of Habitat data (via <code><a href="../reference/create_spp_aoh_data.html">create_spp_aoh_data()</a></code>).</p>
</li>
<li>
<p><strong>The output Area of Habitat data have different spatial extents, how can I combine them together?</strong></p>
<p>The <code><a href="../reference/terra_combine.html">terra_combine()</a></code> function can be used to align and combine a <code>list</code> of raster <code><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">terra::rast()</a></code> objects into a single object. Note that this procedure is only recommended when all species occur in the same geographic region. Please see the tutorial above for an example of using this function to combine Area of Habitat data for multiple species into a single object.</p>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>Hopefully, this vignette has provided a useful introduction to the package. If you encounter any issues when running the code in this tutorial – or when adapting the code for your own work – please see the following section. Additionally, if you have any questions about using the package or suggestions for improving it, please <a href="https://github.com/prioritizr/aoh/issues" class="external-link">file an issue at the package’s online code repository</a>.</p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-r1" class="csl-entry">
Brooks, T.M., Pimm, S.L., Akçakaya, H.R., Buchanan, G.M., Butchart, S.H.M., Foden, W., Hilton-Taylor, C., Hoffmann, M., Jenkins, C.N., Joppa, L., Li, B.V., Menon, V., Ocampo-Peñuela, N. &amp; Rondinini, C. (2019). Measuring terrestrial area of habitat (<span>AOH</span>) and its utility for the <span>IUCN</span> red list. <em>Trends in Ecology and Evolution</em>, <em>34</em>, 977–986.
</div>
<div id="ref-r7" class="csl-entry">
Durán, A.P., Green, J.M.H., West, C.D., Visconti, P., Burgess, N.D., Virah-Sawmy, M. &amp; Balmford, A. (2020). A practical approach to measuring the biodiversity impacts of land conversion. <em>Methods in Ecology and Evolution</em>, <em>11</em>, 910–921.
</div>
<div id="ref-r6" class="csl-entry">
Ficetola, G.F., Rondinini, C., Bonardi, A., Baisero, D. &amp; Padoa-Schioppa, E. (2014). Habitat availability for amphibians and extinction threat: A global analysis (D. Richardson, Ed.). <em>Diversity and Distributions</em>, <em>21</em>, 302–311.
</div>
<div id="ref-r5" class="csl-entry">
Jung, M., Dahal, P.R., Butchart, S.H.M., Donald, P.F., Lamo, X.D., Lesiv, M., Kapos, V., Rondinini, C. &amp; Visconti, P. (2020). A global map of terrestrial habitat types. <em>Scientific Data</em>, <em>7</em>, 256.
</div>
<div id="ref-r9" class="csl-entry">
Lumbierres, M., Dahal, P.R., Marco, M.D., Butchart, S.H.M., Donald, P.F. &amp; Rondinini, C. (2021). Translating habitat class to land cover to map area of habitat of terrestrial vertebrates. <em>Conservation Biology</em>, <em>In press</em>, DOI:10.1111/cobi.13851.
</div>
<div id="ref-r8" class="csl-entry">
Palacio, R.D., Negret, P.J., Velásquez-Tibatá, J. &amp; Jacobson, A.P. (2021). A data-driven geospatial workflow to map species distributions for conservation assessments. <em>Diversity and Distributions</em>.
</div>
<div id="ref-r4" class="csl-entry">
Robinson, N., Regetz, J. &amp; Guralnick, R.P. (2014). <span>EarthEnv</span>-<span>DEM</span>90: A nearly-global, void-free, multi-scale smoothed, 90m digital elevation model from fused <span>ASTER</span> and <span>SRTM</span> data. <em><span>ISPRS</span> Journal of Photogrammetry and Remote Sensing</em>, <em>87</em>, 57–67.
</div>
<div id="ref-r3" class="csl-entry">
Rondinini, C., Stuart, S. &amp; Boitani, L. (2005). <span class="nocase">Habitat suitability models and the shortfall in conservation planning for African vertebrates</span>. <em>Conservation Biology</em>, <em>19</em>, 1488–1497.
</div>
<div id="ref-r2" class="csl-entry">
Tracewski, Łukasz, Butchart, S.H.M., Marco, M.D., Ficetola, G.F., Rondinini, C., Symes, A., Wheatley, H., Beresford, A.E. &amp; Buchanan, G.M. (2016). Toward quantification of the impact of 21st-century deforestation on the extinction risk of terrestrial vertebrates. <em>Conservation Biology</em>, <em>30</em>, 1070–1079.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="http://jeffrey-hanson.com" class="external-link">Jeffrey O Hanson</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
